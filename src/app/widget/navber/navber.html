<mat-toolbar class="top-toolbar">
  <span class="logo">Game Oracle</span>
  <span class="spacer"></span>

  <ng-container *ngIf="!isUserLoggedIn">
    <button mat-flat-button class="auth-button login-btn" routerLink="/login">
      LOGIN
    </button>
    <button
      mat-flat-button
      class="auth-button signup-btn"
      routerLink="/register"
    >
      SIGN UP
    </button>
  </ng-container>

  <ng-container *ngIf="isUserLoggedIn">
    <button
      *ngIf="showCartIcon"
      mat-icon-button
      routerLink="/cart"
      aria-label="Open Shopping Cart"
    >
      <mat-icon>shopping_cart</mat-icon>
    </button>
  </ng-container>
</mat-toolbar>

<div class="nav-action-bar">
  <button
    *ngIf="isUserLoggedIn"
    mat-icon-button
    class="hamburger-menu-btn"
    (click)="toggleProfileSidebar()"
    aria-label="Open Profile Menu"
  >
    <mat-icon>menu</mat-icon>
  </button>

  <div class="nav-links-container">
    <ng-container *ngFor="let link of navLinks">
      <!-- ลิงก์ทั่วไป -->
      <button
        *ngIf="link.name !== 'ประเภทเกม'"
        mat-button
        class="nav-link"
        [class.active]="link.name === activeLink"
        (click)="setActiveLink(link.name)"
        [routerLink]="link.path"
      >
        {{ link.name }}
      </button>

      <!-- ลิงก์ 'ประเภทเกม' แบบมีดรอปดาว -->
      <button
        *ngIf="link.name === 'ประเภทเกม'"
        mat-button
        class="nav-link"
        [class.active]="link.name === activeLink"
        [matMenuTriggerFor]="categoryMenu"
        (menuOpened)="setActiveLink(link.name)"
      >
        {{ link.name }}
        <mat-icon>arrow_drop_down</mat-icon>
      </button>
    </ng-container>
  </div>

  <!-- เมนูดรอปดาวสำหรับ 'ประเภทเกม' -->
  <mat-menu #categoryMenu="matMenu">
    <button
      mat-menu-item
      *ngFor="let c of categories"
      (click)="goToCategory(c)"
    >
      {{ c.name }}
    </button>
  </mat-menu>

  <mat-form-field class="search-form-field" appearance="outline">
    <input
      matInput
      placeholder="ค้นหา"
      #searchInput
      (keyup.enter)="onSearch(searchInput.value)"
    />
    <mat-icon matSuffix>search</mat-icon>
  </mat-form-field>
</div>

<div
  class="profile-overlay"
  [class.open]="isProfileOpen"
  (click)="toggleProfileSidebar()"
></div>

<aside class="profile-sidebar" [class.open]="isProfileOpen">
  <div *ngIf="currentUser" class="profile-details">
    <div class="avatar-container">
      <img
        [src]="userImageUrl || 'assets/images/default-avatar.png'"
        alt="User Avatar"
      />
    </div>
    <h2>ข้อมูลส่วนตัว</h2>

    <div class="info-field">
      <label>Name User</label>
      <div class="info-value">
        <mat-icon>person</mat-icon>
        <span>{{ currentUser.username }}</span>
      </div>
    </div>
    <div class="info-field">
      <label>Gmail User</label>
      <div class="info-value">
        <mat-icon>mail</mat-icon>
        <span>{{ currentUser.email }}</span>
      </div>
    </div>
    <div class="info-field">
      <label>Wallet Balance</label>
      <div class="info-value">
        <mat-icon>account_balance_wallet</mat-icon>
        <span>{{ currentUser.wallet | number : "1.2-2" }}</span>
      </div>
    </div>
  </div>

  <div class="sidebar-footer">
    <button
      mat-flat-button
      class="footer-btn primary-btn"
      routerLink="/editprofile"
    >
      <mat-icon>person</mat-icon>
      <span>แก้ไขโปรไฟล์</span>
    </button>

    <button mat-flat-button class="footer-btn primary-btn" routerLink="/home">
      <mat-icon>home</mat-icon>
      <span>หน้าหลัก</span>
    </button>

    <button mat-flat-button class="footer-btn secondary-btn" (click)="logout()">
      <mat-icon>exit_to_app</mat-icon>
      <span>ออกจากระบบ</span>
    </button>
  </div>
</aside>
