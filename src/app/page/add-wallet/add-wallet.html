<app-navber></app-navber>
<div class="wallet-container">

  <h1 class="page-title">เติมเงิน</h1>

  <div class="balance-display">
    ยอดเงินคงเหลือ: <strong>{{ walletBalance | number:'1.2-2' }}</strong> บาท
  </div>

  <div class="main-section">

    <div class="card history-card">
      <h3>ประวัติการเติมเงิน</h3>
      <ul class="history-list">
        <li *ngIf="topUpHistory.length === 0" class="empty-state">
          ไม่มีประวัติการเติมเงิน
        </li>
        <li *ngFor="let item of topUpHistory">
          <a>{{ item.date }}</a>
          <span class="amount">{{ item.amount | number }} บาท</span>
        </li>
      </ul>
    </div>

    <div class="card form-card">
      <h3>กรอกจำนวนเงินหรือเลือกจำนวนเงิน</h3>

      <input type="number" class="amount-input" placeholder="ระบุจำนวนเงิน (บาท)" [formControl]="amountControl" />

      <div class="predefined-amounts">
        <button *ngFor="let amount of predefinedAmounts" class="amount-chip" (click)="setAmount(amount)">
          {{ amount | number }}
        </button>
      </div>

      <button class="confirm-btn" (click)="onTopUp()" [disabled]="amountControl.invalid">
        ยืนยันการเติมเงิน
      </button>
    </div>
  </div>


  <!-- ===== [แก้ไข] ส่วนของประวัติการซื้อเกมส์ ===== -->
  <h1 class="page-title">ประวัติการซื้อเกมส์</h1>
  <mat-card class="purchase-history-card">
    <mat-card-header>
      <mat-card-subtitle>
        คำสั่งซื้อทั้งหมดของคุณ {{ purchaseHistory.length }} รายการ
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="purchaseHistory.length === 0" class="empty-state">
        คุณยังไม่มีประวัติการซื้อเกม
      </div>

      <!-- ส่วนหัวตาราง -->
      <div class="order-header" *ngIf="purchaseHistory.length > 0">
        <span>#</span>
        <span>วันที่สั่งซื้อ</span>
        <span>ยอดชำระ</span>
      </div>

      <!-- รายการคำสั่งซื้อ -->
      <div class="order-list">
        <!-- วนลูป Orders และทำให้แต่ละแถวคลิกได้ -->
        <div class="order-row" *ngFor="let order of purchaseHistory; let i = index" (click)="openOrderDetails(order)">
          <span class="order-index">#{{ i + 1 }}</span>
          <span class="order-date">{{ order.order_date | date: 'dd MMM yyyy' }}</span>
          <span class="order-total">{{ order.final_total | number: '1.2-2' }} บาท</span>
        </div>
      </div>

    </mat-card-content>
  </mat-card>
</div>


<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeOrderDetails()">
  <div class="modal-content" *ngIf="selectedOrder" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h2>รายละเอียดคำสั่งซื้อ #{{ selectedOrder.orders_id }}</h2>
      <button mat-icon-button (click)="closeOrderDetails()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="modal-game-list">
      <div class="modal-game-item" *ngFor="let detail of selectedOrder.OrderDetails">

        <img [src]="getFullImageUrl(detail.Game.image_game)" [alt]="detail.Game.title" class="game-image">
        <span class="game-title">{{ detail.Game.title }}</span>
        <span class="game-price">{{ detail.Game.price | number: '1.2-2' }} บาท</span>

      </div>
    </div>

    <div class="modal-summary">
      <div class="summary-row">
        <span>ราคารวม</span>
        <span>{{ selectedOrder.sum_total | number: '1.2-2' }} บาท</span>
      </div>
      <div class="summary-row">
        <span>ส่วนลด</span>
        <span class="discount">- {{ selectedOrder.discount | number: '1.2-2' }} บาท</span>
      </div>
      <div class="summary-row total">
        <span>ยอดชำระทั้งหมด</span>
        <span>{{ selectedOrder.final_total | number: '1.2-2' }} บาท</span>
      </div>
    </div>

  </div>
</div>