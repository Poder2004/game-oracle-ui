<app-navber></app-navber>
<div class="wallet-container">
  <!-- ส่วนเติมเงินและประวัติการเติมเงิน (เหมือนเดิม) -->
  <h1 class="page-title">เติมเงิน</h1>
  <mat-card class="balance-card">
    <mat-card-content>
      <h2>ยอดเงินคงเหลือ: {{ walletBalance | number }} บาท</h2>
    </mat-card-content>
  </mat-card>
  <div class="top-up-section">
    <mat-card class="history-card">
      <mat-card-header>
        <mat-card-title>ประวัติการเติมเงิน</mat-card-title>
      </mat-card-header>
      <mat-card-content>
        <div class="history-scroll">
          <ul class="history-list">
            <li *ngIf="topUpHistory.length === 0" class="empty-state">ไม่มีประวัติการเติมเงิน</li>
            <li *ngFor="let item of topUpHistory">
              <span>{{ item.date }}</span>
              <span class="amount">{{ item.amount | number }} บาท</span>
            </li>
          </ul>
        </div>
      </mat-card-content>
    </mat-card>
    <mat-card class="form-card">
      <mat-card-content>
        <p>กรอกจำนวนเงินหรือเลือกจำนวนเงิน</p>

        <mat-form-field appearance="outline" class="amount-field">
          <input
            type="text"
            placeholder="กรอกหรือเลือกจำนวนเงิน"
            matInput
            [formControl]="amountControl"
            [matAutocomplete]="auto"
          />
          <mat-autocomplete #auto="matAutocomplete">
            <mat-option
              *ngFor="let option of filteredOptions | async"
              [value]="option"
            >
              {{ option }} บาท
            </mat-option>
          </mat-autocomplete>
        </mat-form-field>

        <button mat-flat-button class="confirm-btn" (click)="onTopUp()">
          ยืนยันการเติมเงิน
        </button>
      </mat-card-content>
    </mat-card>
  </div>


  <!-- ===== [แก้ไข] ส่วนของประวัติการซื้อเกมส์ ===== -->
  <h1 class="page-title">ประวัติการซื้อเกมส์</h1>
  <mat-card class="purchase-history-card">
    <mat-card-header>
      <mat-card-subtitle>
        คำสั่งซื้อทั้งหมดของคุณ {{ purchaseHistory.length }} รายการ
      </mat-card-subtitle>
    </mat-card-header>
    <mat-card-content>
      <div *ngIf="purchaseHistory.length === 0" class="empty-state">
        คุณยังไม่มีประวัติการซื้อเกม
      </div>

      <!-- ส่วนหัวตาราง -->
      <div class="order-header" *ngIf="purchaseHistory.length > 0">
        <span>#</span>
        <span>วันที่สั่งซื้อ</span>
        <span>ยอดชำระ</span>
      </div>

      <!-- รายการคำสั่งซื้อ -->
      <div class="order-list">
        <!-- วนลูป Orders และทำให้แต่ละแถวคลิกได้ -->
        <div class="order-row" *ngFor="let order of purchaseHistory; let i = index" (click)="openOrderDetails(order)">
          <span class="order-index">#{{ i + 1 }}</span>
          <span class="order-date">{{ order.order_date | date: 'dd MMM yyyy' }}</span>
          <span class="order-total">{{ order.final_total | number: '1.2-2' }} บาท</span>
        </div>
      </div>
      
    </mat-card-content>
  </mat-card>
</div>


<!-- ===== [เพิ่ม] Modal สำหรับแสดงรายละเอียดคำสั่งซื้อ ===== -->
<div class="modal-overlay" *ngIf="isModalOpen" (click)="closeOrderDetails()">
  <div class="modal-content" *ngIf="selectedOrder" (click)="$event.stopPropagation()">
    
    <!-- Header -->
    <div class="modal-header">
      <h2>รายละเอียดคำสั่งซื้อ #{{ selectedOrder.orders_id }}</h2>
      <button mat-icon-button (click)="closeOrderDetails()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- รายการเกมในคำสั่งซื้อ -->
    <div class="modal-game-list">
      <div class="modal-game-item" *ngFor="let detail of selectedOrder.order_details">
        <img [src]="getFullImageUrl(detail.game.image_game)" [alt]="detail.game.title" class="game-image">
        <span class="game-title">{{ detail.game.title }}</span>
        <span class="game-price">{{ detail.game.price | number: '1.2-2' }} บาท</span>
      </div>
    </div>

    <!-- สรุปยอดเงิน -->
    <div class="modal-summary">
      <div class="summary-row">
        <span>ราคารวม</span>
        <span>{{ selectedOrder.sum_total | number: '1.2-2' }} บาท</span>
      </div>
      <div class="summary-row">
        <span>ส่วนลด</span>
        <span class="discount">- {{ selectedOrder.discount | number: '1.2-2' }} บาท</span>
      </div>
      <div class="summary-row total">
        <span>ยอดชำระทั้งหมด</span>
        <span>{{ selectedOrder.final_total | number: '1.2-2' }} บาท</span>
      </div>
    </div>

  </div>
</div>

